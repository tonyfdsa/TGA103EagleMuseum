<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CheckOut</title>
    <!-- /teleplete -->
    <link rel="stylesheet" href="../CSS/templete.css" />
    <!-- bookstrapt -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU"
      crossorigin="anonymous"
    />
     <style>
      .delBtn:hover{
        color: rgba(245, 28, 28, 0.701);
      }

      .buy{
        height: 100%;
        font-size: 14px;
        width: 100px;
        background-color: rgba(247, 110, 60, 0.705);
        color: white;
        cursor: pointer; 
      }
      .buy:hover{
        color: white;
        background-color: rgb(247, 110, 60); 
        font-size: 14px;
      }
     </style>
  </head>


  <body>
    <!-- head -->
    <div class="wrap">
          <div class="row d-flex" >
            <div class="col-1"  alt="大頭貼" ><img src="../img/eagleIcon.jpg" class="min_picture"></img>
              <span id="memberName"></span></div>
            <div class="col-5">
              <h1 style="text-align: center;">Eagle Museum</h1>
            </div>
            <div class="col-6 row d-flex menu btn-group" id="meau">
                <ul class="drop-down-menu d-flex" style="justify-content: end;">
                    <li ><a href="#" class="topTag">首頁</a></li>
                    <li ><a href="exhibition.html" class="topTag">展覽</a></li>
                    <li ><a href="collectionSearch 3.0.html" class="topTag">館藏</a>
                      <ul>
                        <li class="dropMeau"><a href="collectionSearch 3.0.html">館藏資訊</a></li>
                        <li class="dropMeau"><a href="#">館藏地圖</a></li>
                      </ul>
                    </li>
                    <li ><a href="#"  class="topTag">活動</a></li>
                    <li ><a href="#"  class="topTag">商城</a>
                      <ul>
                        <li class="dropMeau"><a href="#">商品列表</a></li>
                        <li class="dropMeau"><a href="#">我的購物車</a></li>
                        <li class="dropMeau"><a href="./buyerCheck.html">訂單查詢</a></li>
                        <li class="dropMeau"><a href="#">最愛清單</a></li>
                      </ul>
                    </li>
                    <li ><a href="#"  class="topTag">會員中心</a>
                      <ul>
                        <li class="dropMeau"><a href="./memberboot.html" >會員資料</a></li>
                        <li class="dropMeau"><a href="#">訂單資料</a></li>
                        <li class="dropMeau"><a href="#">我的收藏</a></li>
                      </ul>
                    </li>
                    <li ><a href="./contactUs(bootstrap).html" class="topTag">聯絡我們</a>
                      <ul>
                          <li class="dropMeau"><a href="./trafic.html">交通資訊</a></li>
                          <li class="dropMeau"><a href="./memberJoin1.html">合作提案</a></li>
                          <li class="dropMeau"><a href="#">捐款</a></li>
                          <li class="dropMeau"><a href="#">問題回饋</a></li>
                          <li class="dropMeau"><a href="#">租借場地</a></li>
                      </ul>
                    </li>
                  </ul>
          </div>
        </div>
    </div>



     
        <div class="upperColumn" id="topcontent" >
        </div>
          
        <!-- </div> -->
       
       <!-- main -->
       <div class="main" style="min-height: 600px;">
        <div style="height: 30px;"></div>
         <div class="container-fluid prod">

          <div class="row">
            <div class="col-1"></div>
            <div class="col-10 ">
              <div style="height: 50px; background-color: rgba(215, 214, 214, 0.39)" class="row">
                <div class="col-1" class="img">
                 
                </div>
                <div class="col-2 d-flex"  style="align-items: center; justify-content: center;">
                  <div style="font-size: 16px;">商品名稱</div>
                </div>
                <div class="col-2 d-flex" style="align-items: center;justify-content: center;">
                  <div style="font-size: 16px;">商品價格</div>
                </div>
                <div class="col-2 d-flex" style="align-items: center;justify-content: center;">
                  <div class="d-flex" align-items: center;>
                    <div style="font-size: 16px;">數量</div>
                  </div>
                </div>
                <div class="col-2 d-flex" style="align-items: center;justify-content: center;">
                  <div style="font-size: 16px;">總價</div>
                </div>

                <div class="col-1 d-flex" style="align-items: center;justify-content: center;">
                  <div class="d-flex" align-items: center;>

                  </div>
                </div>
                
              </div>
            </div>
            <div class="col-1"></div>
          </div>
        



         </div>
         <div class="container-fluid">
          <div class="row" style="margin-top: 10px;">
            <div class="col-1"></div>
            <div class="col-10 " >
              <div style="height: 60px; background-color: rgba(215, 214, 214, 0.39)" class="row">
                <div class="col-8 d-flex" style="align-items: center;">
                  寄送地址:
                  <input class="deliveryAddress" type="text"  style="background-color: rgba(255, 251, 251, 0.33);width: 300px;">
                </div>
                <div class="col-4 d-flex"  style="align-items: center; padding: 0;">
                  郵寄費用:NTD60
                </div>
              </div> 
            </div>
            <div class="col-1"></div>
          </div>
         </div>

         <div class="container-fluid">
          <div class="row" style="margin-top: 5px;">
            <div class="col-1"></div>
            <div class="col-10 " >
              <div style="height: 60px; background-color: rgba(215, 214, 214, 0.39)" class="row">
                <div class="col-8 d-flex" style="align-items: center;">
               
                </div>
                <div class="col-3 d-flex"  style="align-items: center; padding: 0;">
                  總金額:NTD
                  <input class="totalPrice" style="margin-left: 10px; background-color:transparent" type="text" readonly="readonly" vlaue="">
                </div>
                <div class="col-1 d-flex" style="align-items: center; justify-content: end; padding: 0;">
                  <button class="buy">確認結帳</button>
                </div>
              </div> 
            </div>
            <div class="col-1"></div>
          </div>
          <div class="mes" style="color: red;"></div>
         </div>
         




         <div style="height: 20px;"></div>
        
       </div>

       <!-- footer -->
       <div class="footer"></div>

  <!-- jQuery 位置 -->
  <script src="../Vendor/js/jquery3.6.0.js"></script>
  <!-- 模板js匯入 位置 -->
  <script src="../JS/Template .js"></script>

  <script >
  fetch('/TGA103eagleMuseum/CartGet')
  .then(resp => resp.json())
  .then(Data => {

    for(let i = 0 ; i < Data.result.length; i++){

      text = `
      <div class="row" style="margin-top: 5px">
       <div class="col-1"></div>
       <div class="col-10 pr">
         <div style="height: 100px; background-color: rgba(215, 214, 214, 0.39);" class="row">
           <div class="col-1" class="img" style="height: 100%; padding: 0px;">
             <img src=${Data.result[i].prodImg} style="width: 100%;">
           </div>
           <div class="col-2 d-flex"  style="align-items: center; justify-content: center;">
             <div style="font-size: 20px;">${Data.result[i].prodName}</div>
           </div>
           <div class="col-2 d-flex" style="align-items: center;justify-content: center;">
             <input  class="price" readonly="readonly" value =${Data.result[i].prodPrice} style="font-size: 16px; height: 40px; border: 0px solid; width: 50px; background-color:transparent;">
           </div>
           <div class="col-2 d-flex" style="align-items: center;justify-content: center;">
             <div class="col-2 d-flex"  style="align-items: center; justify-content: center;>
               <div style="font-size: 20px;">${Data.result[i].prodCount} </div>
             </div>
             <div class="col-2 d-flex" style="align-items: center;justify-content: center;">
               <input class="total" readonly="readonly" value=${Data.result[i].prodCount * Data.result[i].prodPrice} style="font-size: 16px; height: 40px; border: 0px solid; width: 50px; background-color:transparent;">
             </div>
           </div>


           </div>

         </div>
       </div>
       <div class="col-1"></div>
     </div>
  </div>
      `
       $(".prod").append(text);
    }
    totalprice()
   })

       //計算總金額用方法
       function  totalprice(){
          let totalprice = 0
          let mailPrice = 60;
          for(let i=0; i< $(".total").length;i++){
            totalprice = Number(totalprice) + Number($(".pr").find(".total")[i].value);
            }
            $(".totalPrice").attr("value",(totalprice +  mailPrice))
        }

        //點擊按鈕結帳
        $(".buy").click(function(){
          let orderAmount = document.querySelector(".totalPrice").value;
          let deliveryAddress = document.querySelector(".deliveryAddress").value;
          let URL = '/TGA103eagleMuseum/OrderInsert';
          $("#NAN").remove();
          if (deliveryAddress == ""){
            text="<div style='color: red;' id=NAN> 請輸入地址 </div>"
            $(".deliveryAddress").closest(".col-8").append( text);
          }else{
          //成立訂單
          fetch(URL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
              orderAmount,
              deliveryAddress
              })
            })
            .then(resp => resp.json())
            .then(Data => {  
              console.log(Data);
              if(Data.code == 400){
                $(".mes").html(Data.message);
              }
             
              if(Data.code === 200){
                alert("訂單已成立")
                //清除購物車內容
                fetch("/CartDelAll")
                .then(resp => resp.json)
                .then(Data =>{
                  console.log(Data)
                  location.href = "../../prod/productmenu.html"
                })
                
              }


            })
          }
        })
          //取得上架商品的資料
          fetch('/TGA103eagleMuseum/ProdGetListed')
          .then(resp => resp.json())
          .then(Data => {
            console.log(Data)
            for (let i = 0 ; i< Data.result.length; i++){
              let text=
              `
              <div class="card " id="${Data.result[i].productID}" style="padding: 0%;margin: 0.5% 0.5%; width: 16rem;" >

                  <div class="card-body" >
                    <h5 class="prodName" style="align-items:center">${Data.result[i].prodName}
                      
                    </h5>
                    <p class="prodtext">商品說明</p>
                    <span class="prodPrice"><span>NT$</span>${Data.result[i].prodPrice}</span>
    
                    <span  style="float: right;"  >
                      <svg  class="shoopingCart" data-id = ${Data.result[i].productID} xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="30" height="30">
                        <path d="M11 9h2V6h3V4h-3V1h-2v3H8v2h3v3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2s-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2s2-.9 2-2s-.9-2-2-2zm-8.9-5h7.45c.75 0 1.41-.41 1.75-1.03l3.86-7.01L19.41 4l-3.86 7H8.53L4.27 2H1v2h2l3.6 7.59l-1.35 2.44C4.52 15.37 5.48 17 7 17h12v-2H7l1.1-2z" fill="currentColor"></path>
                      </svg>
                    </span>

                  </div>
                </div>
              `
              $(".product").append(text)
            }
          });


        
          

    
  </script>
</html>
